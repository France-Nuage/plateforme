syntax = "proto3";

package francenuage.fr.resourcemanager.v1;

import "google/protobuf/timestamp.proto";
import "validate.proto";

service Organizations {
    rpc List (ListOrganizationsRequest) returns (ListOrganizationsResponse);
    rpc Create (CreateOrganizationRequest) returns (CreateOrganizationResponse);
}

service Projects {
    rpc List (ListProjectsRequest) returns (ListProjectsResponse);
    rpc Create (CreateProjectRequest) returns (CreateProjectResponse);
}

// OrganizationMembers manages user membership within organizations.
// Member creation is handled via the Invitations service.
service OrganizationMembers {
    // Lists all members of an organization.
    rpc List (ListOrganizationMembersRequest) returns (ListOrganizationMembersResponse);
    // Removes a member from an organization.
    // This creates Operations for SpiceDB and Pangolin synchronization.
    rpc Remove (RemoveOrganizationMemberRequest) returns (RemoveOrganizationMemberResponse);
}

message Organization {
    string id = 1 [(validate.rules).string = {
        min_len: 1,
        max_len: 36,
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
    string name = 2 [(validate.rules).string = {
        min_len: 1,
        max_len: 64,
        pattern: "^[a-zA-Z0-9_\\- ]+$"
    }];
    google.protobuf.Timestamp created_at = 3;
    google.protobuf.Timestamp updated_at = 4;
    string slug = 5 [(validate.rules).string = {
        min_len: 1,
        max_len: 63,
        pattern: "^[a-z0-9]([a-z0-9-]*[a-z0-9])?$"
    }];
}

message Project {
    string id = 1 [(validate.rules).string = {
        min_len: 1, 
        max_len: 36, 
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
    string name = 2 [(validate.rules).string = {
        min_len: 1,
        max_len: 64,
        pattern: "^[a-zA-Z0-9_\\- ]+$"
    }];
    string organization_id = 3 [(validate.rules).string = {
        min_len: 1, 
        max_len: 36, 
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
    google.protobuf.Timestamp created_at = 4;
    google.protobuf.Timestamp updated_at = 5;
}

message ListOrganizationsRequest {}

message ListOrganizationsResponse {
    repeated Organization organizations = 1;
}

message CreateOrganizationRequest {
    string name = 1 [(validate.rules).string = {
        min_len: 1,
        max_len: 64,
        pattern: "^[a-zA-Z0-9_\\- ]+$"
    }];
    optional string parent_id = 2 [(validate.rules).string = {
        min_len: 1, 
        max_len: 36, 
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
}

message CreateOrganizationResponse {
    Organization organization = 1;
}

message ListProjectsRequest {}

message ListProjectsResponse {
    repeated Project projects = 1;
}

message CreateProjectRequest {
    string name = 1 [(validate.rules).string = {
        min_len: 1,
        max_len: 64,
        pattern: "^[a-zA-Z0-9_\\- ]+$"
    }];
    string organization_id = 2 [(validate.rules).string = {
        min_len: 1, 
        max_len: 36, 
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
}

message CreateProjectResponse {
    Project project = 1;
}

// OrganizationMember represents a user's membership in an organization.
message OrganizationMember {
    string user_id = 1;
    string organization_id = 2;
    string email = 3;
    string name = 4;
    // Role assigned to the member (if any)
    string role_id = 5;
    google.protobuf.Timestamp joined_at = 6;
}

message ListOrganizationMembersRequest {
    string organization_id = 1 [(validate.rules).string = {
        min_len: 1,
        max_len: 36,
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
}

message ListOrganizationMembersResponse {
    repeated OrganizationMember members = 1;
}

message RemoveOrganizationMemberRequest {
    string organization_id = 1 [(validate.rules).string = {
        min_len: 1,
        max_len: 36,
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
    string user_id = 2 [(validate.rules).string = {
        min_len: 1,
        max_len: 36,
        pattern: "^[a-zA-Z0-9_-]+$"
    }];
}

message RemoveOrganizationMemberResponse {
    // Operation names for tracking the removal progress
    repeated string operation_names = 1;
}
